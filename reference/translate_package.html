<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function handles the &quot;grunt work&quot; of building and updating translation
libraries. In addition to providing a friendly interface for supplying
translations, some internal logic is built to help make your package more
translation-friendly.
To get started, the package developer should run translate_package() on
your package's source to produce a template .pot file (or files, if your
package has both R and C/C++ messages to translated), e.g.
To add translations in your desired language, include the target language:
in the translate_package(languages = &quot;es&quot;) call."><title>Interactively provide translations for a package's messages — translate_package • potools</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interactively provide translations for a package's messages — translate_package"><meta property="og:description" content="This function handles the &quot;grunt work&quot; of building and updating translation
libraries. In addition to providing a friendly interface for supplying
translations, some internal logic is built to help make your package more
translation-friendly.
To get started, the package developer should run translate_package() on
your package's source to produce a template .pot file (or files, if your
package has both R and C/C++ messages to translated), e.g.
To add translations in your desired language, include the target language:
in the translate_package(languages = &quot;es&quot;) call."><meta property="og:image" content="https://michaelchirico.github.io/potools/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">potools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/custom-diagnostic.html">Writing a custom diagnostic</a>
    <a class="dropdown-item" href="../articles/developers.html">Translation for package developers</a>
    <a class="dropdown-item" href="../articles/translators.html">Translation for package translators</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MichaelChirico/potools/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Interactively provide translations for a package's messages</h1>
      <small class="dont-index">Source: <a href="https://github.com/MichaelChirico/potools/blob/HEAD/R/translate_package.R" class="external-link"><code>R/translate_package.R</code></a></small>
      <div class="d-none name"><code>translate_package.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function handles the "grunt work" of building and updating translation
libraries. In addition to providing a friendly interface for supplying
translations, some internal logic is built to help make your package more
translation-friendly.</p>
<p>To get started, the package developer should run <code>translate_package()</code> on
your package's source to produce a template <code>.pot</code> file (or files, if your
package has both R and C/C++ messages to translated), e.g.</p>
<p>To add translations in your desired language, include the target language:
in the <code>translate_package(languages = "es")</code> call.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">translate_package</span><span class="op">(</span>
  dir <span class="op">=</span> <span class="st">"."</span>,
  <span class="va">languages</span>,
  diagnostics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">check_cracked_messages</span>, <span class="va">check_untranslated_cat</span>,
    <span class="va">check_untranslated_src</span><span class="op">)</span>,
  custom_translation_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>R <span class="op">=</span> <span class="cn">NULL</span>, src <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,
  max_translations <span class="op">=</span> <span class="cn">Inf</span>,
  use_base_rules <span class="op">=</span> <span class="va">package</span> <span class="op">%chin%</span> <span class="va">.potools</span><span class="op">$</span><span class="va">base_package_names</span>,
  copyright <span class="op">=</span> <span class="cn">NULL</span>,
  bugs <span class="op">=</span> <span class="st">""</span>,
  verbose <span class="op">=</span> <span class="op">!</span><span class="fu">is_testing</span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dir</dt>
<dd><p>Character, default the present directory; a directory in which an
R package is stored.</p></dd>
<dt>languages</dt>
<dd><p>Character vector; locale codes to which to translate.
Must be a valid language accepted by gettext. This almost always takes
the form of (1) an ISO 639 2-letter language code; or (2) <code>ll_CC</code>, where
<code>ll</code> is an ISO 639 2-letter language code and <code>CC</code> is an ISO 3166 2-letter
country code e.g. <code>es</code> for Spanish, <code>es_AR</code> for Argentinian Spanish, <code>ro</code>
for Romanian, etc. See <code><a href="https://rdrr.io/r/base/locales.html" class="external-link">base::Sys.getlocale()</a></code> for some helpful tips
about how to tell which locales are currently available on your machine, and
see the References below for some web resources listing more locales.</p></dd>
<dt>diagnostics</dt>
<dd><p>A <code>list</code> of diagnostic functions to be run on the
package's message data. See Details.</p></dd>
<dt>custom_translation_functions</dt>
<dd><p>A <code>list</code> with either/both of two
components, <code>R</code> and <code>src</code>, together governing how to extract any
non-standard strings from the package. See Details.</p></dd>
<dt>max_translations</dt>
<dd><p>Numeric; used for setting a cap on the number of
translations to be done for each language. Defaults to <code>Inf</code>, meaning
all messages in the package.</p></dd>
<dt>use_base_rules</dt>
<dd><p>Logical; Should internal behavior match base behavior
as strictly as possible? <code>TRUE</code> if being run on a base package (i.e.,
<code>base</code> or one of the default packages like <code>utils</code>,
<code>graphics</code>, etc.). See Details.</p></dd>
<dt>copyright</dt>
<dd><p>Character; passed on to <code><a href="write_po_file.html">write_po_file()</a></code>.</p></dd>
<dt>bugs</dt>
<dd><p>Character; passed on to <code><a href="write_po_file.html">write_po_file()</a></code>.</p></dd>
<dt>verbose</dt>
<dd><p>Logical, default <code>TRUE</code> (except during testing). Should
extra information about progress, etc. be reported?</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>This function returns nothing invisibly. As a side effect, a
<code class="file">.pot</code> file is written to the package's <code class="file">po</code> directory (updated if
one does not yet exist, or created from scratch otherwise), and a <code class="file">.po</code>file is written in the same directory for each element of <code>languages</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="phases">Phases<a class="anchor" aria-label="anchor" href="#phases"></a></h2>
    

<p><code>translate_package()</code> goes through roughly three "phases" of translation.</p><ol><li><p>Setup -- <code>dir</code> is checked for existing translations
(toggling between "update" and "new" modes), and R files are parsed and
combed for user-facing messages.</p></li>
<li><p>Diagnostics:  see the Diagnostics section below. Any
diagnostic detecting "unhealthy" messages will result in a yes/no prompt to
exit translation to address the issues before continuing.</p></li>
<li><p>Translation. All of the messages found in phase one are iterated over --
the user is shown a message in English and prompted for the translation
in the target language. This process is repeated for each domain
in <code>languages</code>.</p></li>
</ol><p>An attempt is made to provide hints for some translations that require
special care (e.g. that have escape sequences or use templates). For
templated messages (e.g., that use <code>%s</code>), the user-provided message
must match the templates of the English message. The templates <em>don't</em>
have to be in the same order -- R understands template reordering, e.g.
<code>%2$s</code> says "interpret the second input as a string". See
<code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf()</a></code> for more details.</p>
<p>After each language is completed, a corresponding <code class="file">.po</code> file is written
to the package's <code class="file">po</code> directory (which is created if it does not yet
exist).</p>
<p>There are some discrepancies in the default behavior of
<code>translate_package</code> and the translation workflow used to generate the
<code class="file">.po</code>/<code class="file">.pot</code> files for R itself (mainly, the suite of functions
from <code>tools</code>, <code><a href="https://rdrr.io/r/tools/update_pkg_po.html" class="external-link">tools::update_pkg_po()</a></code>,
<code><a href="https://rdrr.io/r/tools/xgettext.html" class="external-link">tools::xgettext2pot()</a></code>, <code><a href="https://rdrr.io/r/tools/xgettext.html" class="external-link">tools::xgettext()</a></code>, and
<code><a href="https://rdrr.io/r/tools/xgettext.html" class="external-link">tools::xngettext()</a></code>). They should only be superficial (e.g.,
whitespace or comments), but nevertheless may represent a barrier to
smoothly submitting patchings to R Core. To make the process of translating
base R and the default packages (<code>tools</code>, <code>utils</code>, <code>stats</code>,
etc.) as smooth as possible, set the <code>use_base_rules</code> argument to
<code>TRUE</code> and your resulting <code class="file">.po</code>/<code class="file">.pot</code>/<code class="file">.mo</code> file will
match base's.</p>
    </div>
    <div class="section level2">
    <h2 id="custom-translation-functions">Custom translation functions<a class="anchor" aria-label="anchor" href="#custom-translation-functions"></a></h2>
    


<p><code>base</code> R provides several functions for messaging that are natively equipped
for translation (they all have a <code>domain</code> argument): <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code>, <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code>,
<code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code>, <code><a href="https://rdrr.io/r/base/gettext.html" class="external-link">gettext()</a></code>, <code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">gettextf()</a></code>, <code><a href="https://rdrr.io/r/base/gettext.html" class="external-link">ngettext()</a></code>, and
<code><a href="https://rdrr.io/r/base/message.html" class="external-link">packageStartupMessage()</a></code>.</p>
<p>While handy, some developers may prefer to write their own functions, or to
write wrappers of the provided functions that provide some enhanced
functionality (e.g., templating or automatic wrapping). In this case,
the default R tooling for translation (<code>xgettext()</code>, <code>xngettext()</code>
<code>xgettext2pot()</code>, <code>update_pkg_po()</code> from <code>tools</code>) will not work, but
<code>translate_package()</code> and its workhorse <code><a href="get_message_data.html">get_message_data()</a></code> provide an
interface to continue building  translations for your workflow.</p>
<p>Suppose you wrote a function <code>stopf()</code> that is a wrapper of
<code>stop(gettextf())</code> used to build templated error messages in R, which makes
translation easier for translators (see below), e.g.:</p><div class="sourceCode R"><pre><code><span class="va">stopf</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">fmt</span>, <span class="va">...</span>, <span class="va">domain</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">gettextf</a></span><span class="op">(</span><span class="va">fmt</span>, <span class="va">...</span><span class="op">)</span>, domain <span class="op">=</span> <span class="va">domain</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">}</span></code></pre><p></p></div>
<p>Note that <code>potools</code> itself uses just such a wrapper internally to build
error messages! To extract strings from calls in your package to <code>stopf()</code>
and mark them for translation, use the argument
<code>custom_translation_functions</code>:</p><div class="sourceCode R"><pre><code><span class="fu"><a href="../reference/get_message_data.html">get_message_data</a></span><span class="op">(</span>
  <span class="st">'/path/to/my_package'</span>,
  custom_translation_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>R <span class="op">=</span> <span class="st">'stopf:fmt|1'</span><span class="op">)</span>
<span class="op">)</span></code></pre><p></p></div>
<p>This invocation tells <code><a href="get_message_data.html">get_message_data()</a></code> to look for strings in the
<code>fmt</code> argument in calls to <code>stopf()</code>. <code>1</code> indicates that <code>fmt</code> is the
first argument.</p>
<p>This interface is inspired by the <code>--keyword</code> argument to the
<code>xgettext</code> command-line tool. This argument consists of a list with two
components, <code>R</code> and <code>src</code> (either can be excluded), owing to
differences between R and C/C++. Both components, if present, should consist
of a character vector.</p>
<p>For R, there are two types of input: one for named arguments, the other for
unnamed arguments.</p><ul><li><p>Entries for <strong>named</strong> arguments will look like <code>"fname:arg|num"</code> (singular
string) or <code>"fname:arg1|num1,arg2|num2"</code> (plural string). <code>fname</code>
gives the name of the function/call to be extracted from the R source,
<code>arg</code>/<code>arg1</code>/<code>arg2</code> specify the name of the argument to
<code>fname</code> from which strings should be extracted, and
<code>num</code>/<code>num1</code>/<code>num2</code> specify the <em>order</em> of the named
argument within the signature of <code>fname</code>.</p></li>
<li><p>Entries for <strong>unnamed</strong> arguments will look like
<code>"fname:...\xarg1,...,xargn"</code>, i.e., <code>fname</code>, followed by
<code>:</code>, followed by <code>...</code> (three dots), followed by a backslash
(<code>\</code>), followed by a comma-separated list of argument names. All
strings within calls to <code>fname</code> <em>except</em> those supplied to the
arguments named among <code>xarg1</code>, ..., <code>xargn</code> will be extracted.</p></li>
</ul><p>To clarify, consider the how we would (redundantly) specify
<code>custom_translation_functions</code> for some of the default messagers,
<code>gettext</code>, <code>gettextf</code>, and <code>ngettext</code>:
<code>custom_translation_functions = list(R = c("gettext:...\domain", "gettextf:fmt|1", "ngettext:msg1|2,msg2|3"))</code>.</p>
<p>For src, there is only one type of input, which looks like
<code>"fname:num"</code>, which says to look at the <code>num</code> argument of calls
to <code>fname</code> for <code>char</code> arrays.</p>
<p>Note that there is a difference in how translation works for src vs. R -- in
R, all strings passed to certain functions are considered marked for
translations, but in src, all translatable strings must be explicitly marked
as such. So for <code>src</code> translations, <code>custom_translation_functions</code>
is not used to customize which strings are marked for translation, but
rather, to expand the set of calls which are searched for potentially
<em>untranslated</em> arrays (i.e., arrays passed to the specified calls that
are not explicitly marked for translation). These can then be reported in
the <code><a href="check_untranslated_src.html">check_untranslated_src()</a></code> diagnostic, for example.</p>
    </div>
    <div class="section level2">
    <h2 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a></h2>
    

<div class="section">
<h3 id="cracked-messages">Cracked messages<a class="anchor" aria-label="anchor" href="#cracked-messages"></a></h3>


<p>A cracked message is one like:</p><div class="sourceCode r"><pre><code><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"There are "</span>, <span class="va">n</span>, <span class="st">" good things and "</span>, <span class="va">m</span>, <span class="st">" bad things."</span><span class="op">)</span></code></pre><p></p></div>
<p>In its current state, translators will be asked to translate three messages
independently:</p><ul><li><p>"There are"</p></li>
<li><p>"good things and"</p></li>
<li><p>"bad things."</p></li>
</ul><p>The message has been cracked; it might not be possible to translate a string
as generic as "There are" into many languages -- context is key!</p>
<p>To keep the context, the error message should instead be build with
<code>gettextf</code> like so:</p><div class="sourceCode r"><pre><code><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span>domain<span class="op">=</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">gettextf</a></span><span class="op">(</span><span class="st">"There are %d good things and %d bad things."</span><span class="op">)</span><span class="op">)</span></code></pre><p></p></div>
<p>Now there is only one string to translate! Note that this also allows the
translator to change the word order as they see fit -- for example, in
Japanese, the grammatical order usually puts the verb last (where in
English it usually comes right after the subject).</p>
<p><code>translate_package</code> detects such cracked messages and suggests a
<code>gettextf</code>-based approach to fix them.</p>
</div>

<div class="section">
<h3 id="untranslated-r-messages-produced-by-cat-">Untranslated R messages produced by <code><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat()</a></code><a class="anchor" aria-label="anchor" href="#untranslated-r-messages-produced-by-cat-"></a></h3>


<p>Only strings which are passed to certain <code>base</code> functions are eligible for
translation, namely <code>stop</code>, <code>warning</code>, <code>message</code>, <code>packageStartupMessage</code>,
<code>gettext</code>, <code>gettextf</code>, and <code>ngettext</code> (all of which have a <code>domain</code> argument
that is key for translation).</p>
<p>However, it is common to also produce some user-facing messages using
<code>cat</code> -- if your package does so, it must first use <code>gettext</code> or <code>gettextf</code>
to translate the message before sending it to the user with <code>cat</code>.</p>
<p><code>translate_package</code> detects strings produced with <code>cat</code> and suggests a
<code>gettext</code>- or <code>gettextf</code>-based fix.</p>
</div>

<div class="section">
<h3 id="untranslated-c-c-messages">Untranslated C/C++ messages<a class="anchor" aria-label="anchor" href="#untranslated-c-c-messages"></a></h3>


<p>This diagnostic detects any literal <code>char</code> arrays provided to common
messaging functions in C/C++, namely <code><a href="https://rdrr.io/r/base/gettext.html" class="external-link">ngettext()</a></code>, <code>Rprintf()</code>, <code>REprintf()</code>,
<code>Rvprintf()</code>, <code>REvprintf()</code>, <code>R_ShowMessage()</code>, <code>R_Suicide()</code>, <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code>,
<code>Rf_warning()</code>, <code>error()</code>, <code>Rf_error()</code>, <code>dgettext()</code>, and <code>snprintf()</code>.
To actually translate these strings, pass them through the translation
macro <code>_</code>.</p>
<p>NB: Translation in C/C++ requires some additional <code>#include</code>s and
declarations, including defining the <code>_</code> macro.
See the Internationalization section of Writing R Extensions for details.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="custom-diagnostics">Custom diagnostics<a class="anchor" aria-label="anchor" href="#custom-diagnostics"></a></h2>
    


<p>A diagnostic is a function which takes as input a <code>data.table</code>
summarizing the translatable strings in a package (e.g. as generated by
<code><a href="get_message_data.html">get_message_data()</a></code>), evaluates whether these messages are
"healthy" in some sense, and produces a digest of "unhealthy" strings and
(optionally) suggested replacements.</p>
<p>The diagnostic function must have an attribute named <code>diagnostic_tag</code>
that describes what the diagnostic does; it is reproduced in the format
<code>Found {nrow(result)} {diagnostic_tag}:</code>. For example,
<code><a href="check_untranslated_cat.html">check_untranslated_cat()</a></code> has <code>diagnostic_tag = "untranslated messaging calls passed through cat()"</code>.</p>
<p>The output diagnostic result has the following schema:</p><ul><li><p><code>call</code>: <code>character</code>, the call identified as problematic</p></li>
<li><p><code>file</code>: <code>character</code>, the file where <code>call</code> was found</p></li>
<li><p><code>line_number</code>: <code>integer</code>, the line in <code>file</code> where <code>call</code> was found</p></li>
<li><p><code>replacement</code>: <code>character</code>, <em>optional</em>, a suggested fix to make the call
"healthy"</p></li>
</ul><p>See <code><a href="check_cracked_messages.html">check_cracked_messages()</a></code>,
<code><a href="check_untranslated_cat.html">check_untranslated_cat()</a></code>, and
<code><a href="check_untranslated_src.html">check_untranslated_src()</a></code> for examples of diagnostics.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Internationalization" class="external-link">https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Internationalization</a>
<br><a href="https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Internationalization" class="external-link">https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Internationalization</a>
<br><a href="https://cran.r-project.org/doc/manuals/r-release/R-ints.html#Internationalization-in-the-R-sources" class="external-link">https://cran.r-project.org/doc/manuals/r-release/R-ints.html#Internationalization-in-the-R-sources</a>
<br><a href="https://developer.r-project.org/Translations30.html" class="external-link">https://developer.r-project.org/Translations30.html</a> <br><a href="https://www.isi-web.org/publications/glossary-of-statistical-terms" class="external-link">https://www.isi-web.org/publications/glossary-of-statistical-terms</a> <br><a href="https://www.gnu.org/software/gettext/" class="external-link">https://www.gnu.org/software/gettext/</a> <br><a href="https://www.gnu.org/software/gettext/manual/html_node/Usual-Language-Codes.html#Usual-Language-Codes" class="external-link">https://www.gnu.org/software/gettext/manual/html_node/Usual-Language-Codes.html#Usual-Language-Codes</a>
<br><a href="https://www.gnu.org/software/gettext/manual/html_node/Country-Codes.html#Country-Codes" class="external-link">https://www.gnu.org/software/gettext/manual/html_node/Country-Codes.html#Country-Codes</a>
<br><a href="https://www.stats.ox.ac.uk/pub/Rtools/goodies/gettext-tools.zip" class="external-link">https://www.stats.ox.ac.uk/pub/Rtools/goodies/gettext-tools.zip</a>
<br><a href="https://saimana.com/list-of-country-locale-code/" class="external-link">https://saimana.com/list-of-country-locale-code/</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="get_message_data.html">get_message_data()</a></code>, <code><a href="write_po_file.html">write_po_file()</a></code>,
<code><a href="https://rdrr.io/r/tools/xgettext.html" class="external-link">tools::xgettext()</a></code>, <code><a href="https://rdrr.io/r/tools/update_pkg_po.html" class="external-link">tools::update_pkg_po()</a></code>,
<code><a href="https://rdrr.io/r/tools/checkPoFiles.html" class="external-link">tools::checkPoFile()</a></code>, <code><a href="https://rdrr.io/r/base/gettext.html" class="external-link">base::gettext()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Michael Chirico</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="va">pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'pkg'</span>, package <span class="op">=</span> <span class="st">'potools'</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># copy to a temporary location to be able to read/write/update below</span></span>
<span class="r-in"><span class="va">tmp_pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"pkg"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">tmp_pkg</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">pkg</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="va">tmp_pkg</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># run translate_package() without any languages</span></span>
<span class="r-in"><span class="co"># this will generate a .pot template file and en@quot translations (in UTF-8 locales)</span></span>
<span class="r-in"><span class="co"># we can also pass empty 'diagnostics' to skip the diagnostic step</span></span>
<span class="r-in"><span class="co"># (skip if gettext isn't available to avoid an error)</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="va">check_potools_sys_reqs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="fu">translate_package</span><span class="op">(</span><span class="va">tmp_pkg</span>, diagnostics <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># launches the interactive translation dialog for translations into Estonian:</span></span>
<span class="r-in"><span class="fu">translate_package</span><span class="op">(</span><span class="va">tmp_pkg</span>, <span class="st">"et_EE"</span>, diagnostics <span class="op">=</span> <span class="cn">NULL</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># cleanup</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">tmp_pkg</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">pkg</span>, <span class="va">tmp_pkg</span><span class="op">)</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/MichaelChirico" class="external-link">Michael Chirico</a>, Hadley Wickham.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

